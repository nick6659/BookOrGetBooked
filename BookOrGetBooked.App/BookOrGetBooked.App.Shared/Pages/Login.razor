@page "/login"
@using BookOrGetBooked.App.Shared.Interfaces
@using BookOrGetBooked.Shared.DTOs.Auth
@inject NavigationManager Navigation
@inject IAuthService AuthService

<h3>Login</h3>

<EditForm Model="@loginModel" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Email</label>
        <InputText @bind-Value="loginModel.Email" />
    </div>
    <div>
        <label>Password</label>
        <InputText @bind-Value="loginModel.Password" type="password" />
    </div>

    <button type="submit">Login</button>
</EditForm>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p style="color:red">@errorMessage</p>
}

<div style="margin-top: 1rem;">
    <a @onclick="GoToRegister">Don’t have an account? Register</a><br />
    <a @onclick="GoToForgotPassword">Forgot your password?</a>
</div>

@code {
    private LoginRequestDto loginModel = new LoginRequestDto { Email = string.Empty, Password = string.Empty };
    private string? errorMessage;

    private async Task HandleLogin()
    {
        var result = await AuthService.LoginAsync(loginModel);
        if (result.IsSuccess)
        {
            Navigation.NavigateTo("/");
        }
        else
        {
            errorMessage = result.ErrorMessage;
        }
    }

    void GoToRegister() => Navigation.NavigateTo("/register");
    void GoToForgotPassword() => Navigation.NavigateTo("/forgot-password");
}
